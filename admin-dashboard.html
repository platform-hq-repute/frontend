<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - ReputeHQ</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; background: #0D1017; min-height: 100vh; color: #FFFFFF; }

    /* Sidebar */
    .sidebar { position: fixed; left: 0; top: 0; bottom: 0; width: 260px; background: #1A1F36; padding: 24px 16px; display: flex; flex-direction: column; border-right: 1px solid rgba(255,255,255,0.08); z-index: 1000; }
    .sidebar-header { display: flex; align-items: center; gap: 12px; padding: 0 8px; margin-bottom: 8px; }
    .sidebar-logo { width: 40px; height: 40px; }
    .sidebar-brand { color: #FFFFFF; font-size: 20px; font-weight: 700; }
    .admin-badge { display: inline-flex; align-items: center; gap: 6px; background: rgba(245,158,11,0.15); padding: 6px 12px; border-radius: 100px; margin: 0 8px 24px; }
    .admin-badge svg { color: #F59E0B; width: 14px; height: 14px; }
    .admin-badge-text { color: #F59E0B; font-size: 12px; font-weight: 600; }
    .nav-section { margin-bottom: 24px; }
    .nav-section-title { color: rgba(255,255,255,0.4); font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; padding: 0 12px; margin-bottom: 8px; }
    .nav-item { display: flex; align-items: center; gap: 12px; padding: 12px; border-radius: 10px; color: rgba(255,255,255,0.7); text-decoration: none; font-size: 14px; font-weight: 500; transition: all 0.2s; cursor: pointer; }
    .nav-item:hover { background: rgba(255,255,255,0.08); color: #FFFFFF; }
    .nav-item.active { background: rgba(245,158,11,0.15); color: #F59E0B; }
    .nav-item svg { width: 20px; height: 20px; }
    .nav-item .badge { margin-left: auto; background: #F59E0B; color: #0D1017; font-size: 11px; font-weight: 600; padding: 2px 8px; border-radius: 100px; }
    .sidebar-footer { margin-top: auto; padding-top: 24px; border-top: 1px solid rgba(255,255,255,0.1); }
    .user-info { display: flex; align-items: center; gap: 12px; padding: 12px; }
    .user-avatar { width: 40px; height: 40px; border-radius: 10px; background: linear-gradient(135deg, #F59E0B, #D97706); display: flex; align-items: center; justify-content: center; color: #FFFFFF; font-weight: 600; font-size: 16px; }
    .user-details { flex: 1; }
    .user-name { color: #FFFFFF; font-size: 14px; font-weight: 600; }
    .user-role { color: #F59E0B; font-size: 12px; font-weight: 500; }

    /* Main Content */
    .main-content { margin-left: 260px; min-height: 100vh; }
    .top-bar { background: rgba(26,31,54,0.8); backdrop-filter: blur(10px); padding: 20px 32px; border-bottom: 1px solid rgba(255,255,255,0.08); display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 100; }
    .page-title { color: #FFFFFF; font-size: 24px; font-weight: 700; }
    .top-bar-actions { display: flex; align-items: center; gap: 16px; }
    .btn { padding: 10px 20px; border-radius: 10px; font-size: 14px; font-weight: 600; font-family: inherit; cursor: pointer; transition: all 0.2s; display: inline-flex; align-items: center; gap: 8px; text-decoration: none; border: none; }
    .btn-admin { background: #F59E0B; color: #0D1017; }
    .btn-admin:hover { background: #FBBF24; }
    .btn-outline { background: transparent; color: rgba(255,255,255,0.7); border: 1px solid rgba(255,255,255,0.2); }
    .btn-outline:hover { background: rgba(255,255,255,0.08); color: #FFFFFF; }
    .btn-sm { padding: 6px 12px; font-size: 13px; }
    .btn-danger { background: #DC2626; color: #FFFFFF; }
    .btn-danger:hover { background: #EF4444; }
    .content-area { padding: 32px; }

    /* Page Views */
    .page-view { display: none; }
    .page-view.active { display: block; }

    /* Stats Grid */
    .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 24px; margin-bottom: 32px; }
    .stat-card { background: rgba(255,255,255,0.03); border-radius: 16px; padding: 24px; border: 1px solid rgba(255,255,255,0.08); }
    .stat-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; }
    .stat-icon { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; }
    .stat-icon.amber { background: rgba(245,158,11,0.15); color: #F59E0B; }
    .stat-icon.teal { background: rgba(0,212,170,0.15); color: #00D4AA; }
    .stat-icon.blue { background: rgba(59,130,246,0.15); color: #3B82F6; }
    .stat-icon.purple { background: rgba(139,92,246,0.15); color: #8B5CF6; }
    .stat-change { display: inline-flex; align-items: center; gap: 4px; font-size: 12px; font-weight: 600; padding: 4px 8px; border-radius: 100px; }
    .stat-change.positive { background: rgba(0,212,170,0.15); color: #00D4AA; }
    .stat-value { font-size: 32px; font-weight: 700; color: #FFFFFF; margin-bottom: 4px; }
    .stat-label { color: rgba(255,255,255,0.5); font-size: 14px; }

    /* Cards */
    .card { background: rgba(255,255,255,0.03); border-radius: 16px; border: 1px solid rgba(255,255,255,0.08); overflow: hidden; margin-bottom: 24px; }
    .card-header { padding: 20px 24px; border-bottom: 1px solid rgba(255,255,255,0.08); display: flex; align-items: center; justify-content: space-between; }
    .card-title { font-size: 16px; font-weight: 600; color: #FFFFFF; }
    .card-body { padding: 0; }

    /* Table */
    .table { width: 100%; border-collapse: collapse; }
    .table th, .table td { text-align: left; padding: 16px 24px; border-bottom: 1px solid rgba(255,255,255,0.06); }
    .table th { color: rgba(255,255,255,0.5); font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; background: rgba(0,0,0,0.2); }
    .table td { color: #FFFFFF; font-size: 14px; }
    .table tr:last-child td { border-bottom: none; }
    .table tr:hover td { background: rgba(255,255,255,0.02); }
    .user-cell { display: flex; align-items: center; gap: 12px; }
    .user-cell-avatar { width: 36px; height: 36px; border-radius: 8px; background: linear-gradient(135deg, #00D4AA, #0D9488); display: flex; align-items: center; justify-content: center; color: #FFFFFF; font-weight: 600; font-size: 12px; }
    .user-cell-info { display: flex; flex-direction: column; }
    .user-cell-name { font-weight: 600; }
    .user-cell-email { color: rgba(255,255,255,0.5); font-size: 12px; }
    .status-badge { display: inline-flex; align-items: center; gap: 6px; padding: 4px 10px; border-radius: 100px; font-size: 12px; font-weight: 500; }
    .status-badge.active { background: rgba(0,212,170,0.15); color: #00D4AA; }
    .status-badge.pending { background: rgba(245,158,11,0.15); color: #F59E0B; }
    .status-badge.suspended { background: rgba(239,68,68,0.15); color: #EF4444; }
    .status-dot { width: 6px; height: 6px; border-radius: 50%; background: currentColor; }
    .action-btn { padding: 6px 12px; border-radius: 6px; font-size: 12px; font-weight: 500; cursor: pointer; transition: all 0.2s; border: none; font-family: inherit; background: rgba(255,255,255,0.08); color: rgba(255,255,255,0.7); margin-right: 8px; }
    .action-btn:hover { background: rgba(255,255,255,0.12); color: #FFFFFF; }
    .action-btn:last-child { margin-right: 0; }
    .action-btn.danger { background: rgba(239,68,68,0.15); color: #EF4444; }
    .action-btn.danger:hover { background: rgba(239,68,68,0.25); }

    /* Filter Chips */
    .filter-chips { display: flex; gap: 8px; margin-bottom: 24px; flex-wrap: wrap; }
    .filter-chip { padding: 8px 16px; border-radius: 100px; font-size: 13px; font-weight: 500; cursor: pointer; transition: all 0.2s; border: 1px solid rgba(255,255,255,0.1); background: transparent; color: rgba(255,255,255,0.6); }
    .filter-chip:hover { border-color: #F59E0B; }
    .filter-chip.active { background: #F59E0B; color: #0D1017; border-color: #F59E0B; }
    .filter-chip .count { margin-left: 6px; background: rgba(0,0,0,0.2); padding: 2px 8px; border-radius: 100px; font-size: 11px; }

    /* Search */
    .search-box { position: relative; margin-bottom: 24px; }
    .search-input { width: 100%; max-width: 400px; padding: 12px 16px 12px 44px; border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; background: rgba(255,255,255,0.03); color: #FFFFFF; font-size: 14px; font-family: inherit; }
    .search-input::placeholder { color: rgba(255,255,255,0.4); }
    .search-input:focus { outline: none; border-color: #F59E0B; }
    .search-icon { position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: rgba(255,255,255,0.4); }

    /* Modal */
    .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); display: none; align-items: center; justify-content: center; z-index: 2000; }
    .modal-overlay.active { display: flex; }
    .modal { background: #1A1F36; border-radius: 20px; width: 100%; max-width: 500px; max-height: 90vh; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); }
    .modal-header { padding: 24px; border-bottom: 1px solid rgba(255,255,255,0.08); display: flex; align-items: center; justify-content: space-between; }
    .modal-title { font-size: 18px; font-weight: 600; color: #FFFFFF; }
    .modal-close { width: 36px; height: 36px; border-radius: 8px; background: rgba(255,255,255,0.08); border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; color: rgba(255,255,255,0.6); transition: all 0.2s; }
    .modal-close:hover { background: rgba(255,255,255,0.12); color: #FFFFFF; }
    .modal-body { padding: 24px; overflow-y: auto; }
    .modal-footer { padding: 24px; border-top: 1px solid rgba(255,255,255,0.08); display: flex; gap: 12px; justify-content: flex-end; }

    /* Form */
    .form-group { margin-bottom: 20px; }
    .form-label { display: block; font-weight: 500; color: #FFFFFF; margin-bottom: 8px; font-size: 14px; }
    .form-input, .form-select { width: 100%; padding: 12px 16px; border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; background: rgba(255,255,255,0.03); color: #FFFFFF; font-size: 14px; font-family: inherit; }
    .form-input:focus, .form-select:focus { outline: none; border-color: #F59E0B; }
    .form-select { cursor: pointer; }
    .form-select option { background: #1A1F36; color: #FFFFFF; }

    /* Review Card */
    .review-card { background: rgba(255,255,255,0.03); border-radius: 12px; padding: 20px; margin-bottom: 16px; border: 1px solid rgba(255,255,255,0.06); }
    .review-header { display: flex; align-items: flex-start; gap: 12px; margin-bottom: 12px; }
    .review-avatar { width: 40px; height: 40px; border-radius: 10px; background: linear-gradient(135deg, #1A1F36, #2D3555); display: flex; align-items: center; justify-content: center; color: #FFFFFF; font-weight: 600; }
    .review-info { flex: 1; }
    .review-author { font-weight: 600; color: #FFFFFF; margin-bottom: 4px; }
    .review-meta { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
    .review-rating { display: flex; gap: 2px; }
    .star { color: rgba(255,255,255,0.2); }
    .star.filled { color: #FBBF24; }
    .review-date { color: rgba(255,255,255,0.4); font-size: 12px; }
    .review-content { color: rgba(255,255,255,0.7); font-size: 14px; line-height: 1.6; margin-bottom: 12px; }
    .review-tags { display: flex; gap: 8px; flex-wrap: wrap; }
    .review-tag { background: rgba(255,255,255,0.08); color: rgba(255,255,255,0.6); padding: 4px 10px; border-radius: 100px; font-size: 11px; font-weight: 500; }

    /* Toast */
    .toast { position: fixed; bottom: 24px; right: 24px; background: #1A1F36; color: #FFFFFF; padding: 16px 24px; border-radius: 12px; display: flex; align-items: center; gap: 12px; z-index: 3000; transform: translateY(100px); opacity: 0; transition: all 0.3s; border: 1px solid rgba(255,255,255,0.1); }
    .toast.show { transform: translateY(0); opacity: 1; }
    .toast.success { background: #059669; border-color: #059669; }
    .toast.error { background: #DC2626; border-color: #DC2626; }

    /* Empty State */
    .empty-state { text-align: center; padding: 64px 24px; }
    .empty-state-icon { width: 80px; height: 80px; border-radius: 20px; background: rgba(255,255,255,0.05); display: flex; align-items: center; justify-content: center; margin: 0 auto 24px; color: rgba(255,255,255,0.3); }
    .empty-state-title { font-size: 18px; font-weight: 600; color: #FFFFFF; margin-bottom: 8px; }
    .empty-state-desc { color: rgba(255,255,255,0.5); font-size: 14px; }

    /* Mobile Menu Button */
    .mobile-menu-btn { display: none; position: fixed; top: 16px; left: 16px; z-index: 1001; width: 44px; height: 44px; border-radius: 12px; background: #F59E0B; border: none; color: #0D1017; cursor: pointer; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); }
    .mobile-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); z-index: 999; }
    .mobile-overlay.active { display: block; }

    /* Responsive */
    @media (max-width: 1200px) { .stats-grid { grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 768px) {
      .mobile-menu-btn { display: flex; }
      .sidebar { transform: translateX(-100%); transition: transform 0.3s ease; }
      .sidebar.open { transform: translateX(0); }
      .main-content { margin-left: 0; }
      .stats-grid { grid-template-columns: 1fr 1fr; gap: 12px; }
      .stat-card { padding: 16px; }
      .stat-value { font-size: 24px; }
      .top-bar { padding: 16px; padding-left: 70px; }
      .page-title { font-size: 18px; }
      .content-area { padding: 16px; }
      .data-table { font-size: 13px; }
      .toast { left: 16px; right: 16px; bottom: 16px; }
      .card-header { flex-direction: column; align-items: flex-start; gap: 12px; }
      .search-input { max-width: 100%; }
      .filter-chips { overflow-x: auto; flex-wrap: nowrap; padding-bottom: 8px; }
      .filter-chip { flex-shrink: 0; }
      .modal { margin: 16px; }
    }
    @media (max-width: 500px) {
      .stats-grid { grid-template-columns: 1fr; }
      .data-table th:nth-child(4), .data-table td:nth-child(4),
      .data-table th:nth-child(5), .data-table td:nth-child(5) { display: none; }
    }
  </style>
</head>
<body>
  <!-- Mobile Menu Button -->
  <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <line x1="3" y1="12" x2="21" y2="12"/>
      <line x1="3" y1="6" x2="21" y2="6"/>
      <line x1="3" y1="18" x2="21" y2="18"/>
    </svg>
  </button>

  <!-- Mobile Overlay -->
  <div class="mobile-overlay" id="mobileOverlay" onclick="closeMobileMenu()"></div>

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <img src="real-logo.png" alt="ReputeHQ" class="sidebar-logo">
      <span class="sidebar-brand">ReputeHQ</span>
    </div>
    <div class="admin-badge">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
      <span class="admin-badge-text">Admin Portal</span>
    </div>
    <nav>
      <div class="nav-section">
        <div class="nav-section-title">Overview</div>
        <a href="#" class="nav-item active" data-page="dashboard">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="9" rx="1"/><rect x="14" y="3" width="7" height="5" rx="1"/><rect x="14" y="12" width="7" height="9" rx="1"/><rect x="3" y="16" width="7" height="5" rx="1"/></svg>
          Dashboard
        </a>
      </div>
      <div class="nav-section">
        <div class="nav-section-title">Management</div>
        <a href="#" class="nav-item" data-page="users">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
          Users
          <span class="badge" id="usersBadge">0</span>
        </a>
        <a href="#" class="nav-item" data-page="businesses">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
          Businesses
        </a>
        <a href="#" class="nav-item" data-page="reviews">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
          Reviews
        </a>
      </div>
    </nav>
    <div class="sidebar-footer">
      <div class="user-info">
        <div class="user-avatar" id="adminAvatar">A</div>
        <div class="user-details">
          <div class="user-name" id="adminName">Admin</div>
          <div class="user-role" id="adminRole">Administrator</div>
        </div>
      </div>
      <a href="#" class="nav-item" onclick="logout(); return false;">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
        Sign Out
      </a>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Dashboard Page -->
    <div id="dashboardPage" class="page-view active">
      <div class="top-bar">
        <h1 class="page-title">Admin Dashboard</h1>
        <div class="top-bar-actions">
          <button class="btn btn-outline" onclick="exportReport()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
            Export Report
          </button>
        </div>
      </div>
      <div class="content-area">
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-header"><div class="stat-icon teal"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg></div><span class="stat-change positive">+24%</span></div>
            <div class="stat-value" id="statTotalUsers">0</div>
            <div class="stat-label">Total Users</div>
          </div>
          <div class="stat-card">
            <div class="stat-header"><div class="stat-icon amber"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg></div><span class="stat-change positive">+18%</span></div>
            <div class="stat-value" id="statTotalBusinesses">0</div>
            <div class="stat-label">Total Businesses</div>
          </div>
          <div class="stat-card">
            <div class="stat-header"><div class="stat-icon blue"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg></div><span class="stat-change positive">+32%</span></div>
            <div class="stat-value" id="statTotalReviews">0</div>
            <div class="stat-label">Total Reviews</div>
          </div>
          <div class="stat-card">
            <div class="stat-header"><div class="stat-icon purple"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg></div></div>
            <div class="stat-value" id="statAvgRating">0.0</div>
            <div class="stat-label">Avg Rating</div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Recent Users</h2>
            <button class="btn btn-outline btn-sm" onclick="navigateTo('users')">View All</button>
          </div>
          <div class="card-body">
            <table class="table">
              <thead><tr><th>User</th><th>Status</th><th>Joined</th><th>Actions</th></tr></thead>
              <tbody id="recentUsersTable"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Users Page -->
    <div id="usersPage" class="page-view">
      <div class="top-bar">
        <h1 class="page-title">Users Management</h1>
      </div>
      <div class="content-area">
        <div class="search-box">
          <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
          <input type="text" class="search-input" id="userSearch" placeholder="Search users..." oninput="filterUsers()">
        </div>
        <div class="filter-chips">
          <div class="filter-chip active" data-filter="all" onclick="setUserFilter('all')">All <span class="count" id="filterAllUsers">0</span></div>
          <div class="filter-chip" data-filter="active" onclick="setUserFilter('active')">Active <span class="count" id="filterActiveUsers">0</span></div>
          <div class="filter-chip" data-filter="suspended" onclick="setUserFilter('suspended')">Suspended <span class="count" id="filterSuspendedUsers">0</span></div>
        </div>
        <div class="card">
          <div class="card-body">
            <table class="table">
              <thead><tr><th>User</th><th>Businesses</th><th>Status</th><th>Joined</th><th>Actions</th></tr></thead>
              <tbody id="usersTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Businesses Page -->
    <div id="businessesPage" class="page-view">
      <div class="top-bar">
        <h1 class="page-title">Businesses Management</h1>
      </div>
      <div class="content-area">
        <div class="search-box">
          <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
          <input type="text" class="search-input" id="businessSearch" placeholder="Search businesses..." oninput="filterBusinesses()">
        </div>
        <div class="card">
          <div class="card-body">
            <table class="table">
              <thead><tr><th>Business</th><th>Owner</th><th>Rating</th><th>Reviews</th><th>Status</th><th>Actions</th></tr></thead>
              <tbody id="businessesTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Reviews Page -->
    <div id="reviewsPage" class="page-view">
      <div class="top-bar">
        <h1 class="page-title">Reviews Management</h1>
      </div>
      <div class="content-area">
        <div class="filter-chips">
          <div class="filter-chip active" data-filter="all" onclick="setReviewFilter('all')">All <span class="count" id="filterAllReviews">0</span></div>
          <div class="filter-chip" data-filter="pending" onclick="setReviewFilter('pending')">Pending <span class="count" id="filterPendingReviews">0</span></div>
          <div class="filter-chip" data-filter="ai_generated" onclick="setReviewFilter('ai_generated')">AI Ready <span class="count" id="filterAiReviews">0</span></div>
          <div class="filter-chip" data-filter="responded" onclick="setReviewFilter('responded')">Responded <span class="count" id="filterRespondedReviews">0</span></div>
        </div>
        <div id="reviewsList"></div>
      </div>
    </div>
  </main>

  <!-- Edit User Modal -->
  <div class="modal-overlay" id="editUserModal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">Edit User</h2>
        <button class="modal-close" onclick="closeEditUserModal()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
        </button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="editUserId">
        <div class="form-group">
          <label class="form-label">Name</label>
          <input type="text" class="form-input" id="editUserName" placeholder="Enter name">
        </div>
        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" class="form-input" id="editUserEmail" placeholder="Enter email">
        </div>
        <div class="form-group">
          <label class="form-label">Status</label>
          <select class="form-select" id="editUserStatus">
            <option value="active">Active</option>
            <option value="suspended">Suspended</option>
            <option value="pending">Pending</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="closeEditUserModal()">Cancel</button>
        <button class="btn btn-admin" onclick="saveUser()">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast"><span id="toastMessage">Success!</span></div>

  <script>
    // Configuration
    const SUPABASE_URL = 'https://djwrwqbyujbkvvftjvud.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRqd3J3cWJ5dWpia3Z2ZnRqdnVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg5MzA5OTUsImV4cCI6MjA4NDUwNjk5NX0.bWiMUPx96w4LWK2c1k65n9l0iBd9jzGCF7n5VEDnick';
    const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // State
    let currentAdmin = null;
    let users = [];
    let businesses = [];
    let reviews = [];
    let userFilter = 'all';
    let reviewFilter = 'all';

    // Initialize
    document.addEventListener('DOMContentLoaded', async () => {
      const storedAdmin = localStorage.getItem('reputehq_admin');
      if (!storedAdmin) { window.location.href = 'admin-login.html'; return; }
      currentAdmin = JSON.parse(storedAdmin);
      updateAdminUI();
      await loadData();
      setupNavigation();
    });

    function updateAdminUI() {
      const initials = (currentAdmin.name || currentAdmin.email || 'A').split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
      document.getElementById('adminAvatar').textContent = initials;
      document.getElementById('adminName').textContent = currentAdmin.name || 'Admin';
      document.getElementById('adminRole').textContent = currentAdmin.role || 'Administrator';
    }

    async function loadData() {
      await Promise.all([loadUsers(), loadBusinesses(), loadReviews()]);
      updateStats();
      renderRecentUsers();
      renderUsers();
      renderBusinesses();
      renderReviews();
    }

    async function loadUsers() {
      const { data, error } = await supabaseClient.from('users').select('*').order('created_at', { ascending: false });
      if (error) { console.error('Error loading users:', error); return; }
      users = (data || []).map(row => ({
        id: row.id, email: row.email, name: row.name, avatar: row.avatar,
        createdAt: row.created_at, status: row.status || 'active', businessCount: row.business_count || 0
      }));
    }

    async function loadBusinesses() {
      const { data, error } = await supabaseClient.from('locations').select('*').order('created_at', { ascending: false });
      if (error) { console.error('Error loading businesses:', error); return; }
      businesses = (data || []).map(row => ({
        id: row.id, name: row.name, address: row.address, averageRating: row.average_rating || 0,
        totalReviews: row.total_reviews || 0, ownerId: row.owner_id, ownerName: row.owner_name, status: row.status || 'active'
      }));
    }

    async function loadReviews() {
      const { data, error } = await supabaseClient.from('reviews').select('*').order('created_at', { ascending: false });
      if (error) { console.error('Error loading reviews:', error); return; }
      reviews = (data || []).map(row => ({
        id: row.id, locationId: row.location_id, locationName: row.location_name, platform: row.platform,
        authorName: row.author_name, rating: row.rating, content: row.content, createdAt: row.created_at,
        status: row.status, aiResponse: row.ai_response, publishedResponse: row.published_response
      }));
    }

    function updateStats() {
      const avgRating = reviews.length > 0 ? (reviews.reduce((sum, r) => sum + r.rating, 0) / reviews.length).toFixed(1) : '0.0';
      document.getElementById('statTotalUsers').textContent = users.length;
      document.getElementById('statTotalBusinesses').textContent = businesses.length;
      document.getElementById('statTotalReviews').textContent = reviews.length;
      document.getElementById('statAvgRating').textContent = avgRating;
      document.getElementById('usersBadge').textContent = users.length;
      document.getElementById('filterAllUsers').textContent = users.length;
      document.getElementById('filterActiveUsers').textContent = users.filter(u => u.status === 'active').length;
      document.getElementById('filterSuspendedUsers').textContent = users.filter(u => u.status === 'suspended').length;
      document.getElementById('filterAllReviews').textContent = reviews.length;
      document.getElementById('filterPendingReviews').textContent = reviews.filter(r => r.status === 'pending').length;
      document.getElementById('filterAiReviews').textContent = reviews.filter(r => r.status === 'ai_generated').length;
      document.getElementById('filterRespondedReviews').textContent = reviews.filter(r => r.status === 'responded').length;
    }

    function renderRecentUsers() {
      const tbody = document.getElementById('recentUsersTable');
      const recentUsers = users.slice(0, 5);
      if (recentUsers.length === 0) {
        tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;color:rgba(255,255,255,0.5);padding:40px;">No users found</td></tr>';
        return;
      }
      tbody.innerHTML = recentUsers.map(user => {
        const initials = (user.name || user.email || 'U').split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
        const date = new Date(user.createdAt).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        return `<tr>
          <td><div class="user-cell"><div class="user-cell-avatar">${initials}</div><div class="user-cell-info"><span class="user-cell-name">${user.name || 'Unnamed'}</span><span class="user-cell-email">${user.email}</span></div></div></td>
          <td><span class="status-badge ${user.status}"><span class="status-dot"></span>${user.status}</span></td>
          <td>${date}</td>
          <td><button class="action-btn" onclick="editUser('${user.id}')">Edit</button></td>
        </tr>`;
      }).join('');
    }

    function renderUsers() {
      const tbody = document.getElementById('usersTableBody');
      const searchTerm = document.getElementById('userSearch')?.value.toLowerCase() || '';
      let filtered = users.filter(u => userFilter === 'all' || u.status === userFilter);
      if (searchTerm) filtered = filtered.filter(u => (u.name || '').toLowerCase().includes(searchTerm) || (u.email || '').toLowerCase().includes(searchTerm));
      if (filtered.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;color:rgba(255,255,255,0.5);padding:40px;">No users found</td></tr>';
        return;
      }
      tbody.innerHTML = filtered.map(user => {
        const initials = (user.name || user.email || 'U').split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
        const date = new Date(user.createdAt).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        return `<tr>
          <td><div class="user-cell"><div class="user-cell-avatar">${initials}</div><div class="user-cell-info"><span class="user-cell-name">${user.name || 'Unnamed'}</span><span class="user-cell-email">${user.email}</span></div></div></td>
          <td>${user.businessCount}</td>
          <td><span class="status-badge ${user.status}"><span class="status-dot"></span>${user.status}</span></td>
          <td>${date}</td>
          <td><button class="action-btn" onclick="editUser('${user.id}')">Edit</button><button class="action-btn danger" onclick="deleteUser('${user.id}')">Delete</button></td>
        </tr>`;
      }).join('');
    }

    function renderBusinesses() {
      const tbody = document.getElementById('businessesTableBody');
      const searchTerm = document.getElementById('businessSearch')?.value.toLowerCase() || '';
      let filtered = businesses;
      if (searchTerm) filtered = filtered.filter(b => b.name.toLowerCase().includes(searchTerm) || (b.ownerName || '').toLowerCase().includes(searchTerm));
      if (filtered.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;color:rgba(255,255,255,0.5);padding:40px;">No businesses found</td></tr>';
        return;
      }
      tbody.innerHTML = filtered.map(biz => `<tr>
        <td><div class="user-cell"><div class="user-cell-avatar" style="background:linear-gradient(135deg,#F59E0B,#D97706);">üìç</div><div class="user-cell-info"><span class="user-cell-name">${biz.name}</span><span class="user-cell-email">${biz.address}</span></div></div></td>
        <td>${biz.ownerName || '-'}</td>
        <td><span style="color:#FBBF24;">‚òÖ</span> ${biz.averageRating.toFixed(1)}</td>
        <td>${biz.totalReviews}</td>
        <td><span class="status-badge ${biz.status}"><span class="status-dot"></span>${biz.status}</span></td>
        <td><button class="action-btn" onclick="viewBusiness('${biz.id}')">View</button><button class="action-btn danger" onclick="deleteBusiness('${biz.id}')">Delete</button></td>
      </tr>`).join('');
    }

    function renderReviews() {
      const container = document.getElementById('reviewsList');
      let filtered = reviews.filter(r => reviewFilter === 'all' || r.status === reviewFilter);
      if (filtered.length === 0) {
        container.innerHTML = `<div class="empty-state"><div class="empty-state-icon"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg></div><div class="empty-state-title">No reviews found</div><div class="empty-state-desc">Try adjusting your filters</div></div>`;
        return;
      }
      container.innerHTML = filtered.map(review => {
        const initial = review.authorName ? review.authorName.charAt(0).toUpperCase() : 'R';
        const stars = Array(5).fill(0).map((_, i) => `<span class="star ${i < review.rating ? 'filled' : ''}">‚òÖ</span>`).join('');
        const date = new Date(review.createdAt).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        const statusLabels = { pending: 'Pending', ai_generated: 'AI Ready', responded: 'Responded' };
        return `<div class="review-card">
          <div class="review-header">
            <div class="review-avatar">${initial}</div>
            <div class="review-info">
              <div class="review-author">${review.authorName || 'Anonymous'}</div>
              <div class="review-meta"><div class="review-rating">${stars}</div><span class="review-date">${date}</span><span class="status-badge ${review.status}">${statusLabels[review.status] || review.status}</span></div>
            </div>
          </div>
          <div class="review-content">${review.content || 'No content'}</div>
          <div class="review-tags"><span class="review-tag">${review.locationName || 'Unknown'}</span><span class="review-tag" style="text-transform:capitalize;">${review.platform || 'Unknown'}</span></div>
        </div>`;
      }).join('');
    }

    // Navigation
    function setupNavigation() {
      document.querySelectorAll('.nav-item[data-page]').forEach(item => {
        item.addEventListener('click', e => { e.preventDefault(); navigateTo(item.dataset.page); });
      });
    }

    function navigateTo(page) {
      document.querySelectorAll('.nav-item[data-page]').forEach(item => item.classList.toggle('active', item.dataset.page === page));
      document.querySelectorAll('.page-view').forEach(view => view.classList.remove('active'));
      document.getElementById(`${page}Page`).classList.add('active');
      closeMobileMenu();
    }

    // Filters
    function setUserFilter(filter) {
      userFilter = filter;
      document.querySelectorAll('#usersPage .filter-chip').forEach(c => c.classList.toggle('active', c.dataset.filter === filter));
      renderUsers();
    }

    function filterUsers() { renderUsers(); }
    function filterBusinesses() { renderBusinesses(); }

    function setReviewFilter(filter) {
      reviewFilter = filter;
      document.querySelectorAll('#reviewsPage .filter-chip').forEach(c => c.classList.toggle('active', c.dataset.filter === filter));
      renderReviews();
    }

    // User Management
    function editUser(userId) {
      const user = users.find(u => u.id === userId);
      if (!user) return;
      document.getElementById('editUserId').value = user.id;
      document.getElementById('editUserName').value = user.name || '';
      document.getElementById('editUserEmail').value = user.email || '';
      document.getElementById('editUserStatus').value = user.status || 'active';
      document.getElementById('editUserModal').classList.add('active');
    }

    function closeEditUserModal() { document.getElementById('editUserModal').classList.remove('active'); }

    async function saveUser() {
      const userId = document.getElementById('editUserId').value;
      const name = document.getElementById('editUserName').value;
      const email = document.getElementById('editUserEmail').value;
      const status = document.getElementById('editUserStatus').value;
      try {
        const { error } = await supabaseClient.from('users').update({ name, email, status }).eq('id', userId);
        if (error) throw error;
        const idx = users.findIndex(u => u.id === userId);
        if (idx !== -1) { users[idx] = { ...users[idx], name, email, status }; }
        updateStats(); renderRecentUsers(); renderUsers();
        closeEditUserModal();
        showToast('User updated successfully!', 'success');
      } catch (error) { console.error('Error saving user:', error); showToast('Failed to save user', 'error'); }
    }

    async function deleteUser(userId) {
      if (!confirm('Are you sure you want to delete this user?')) return;
      try {
        const { error } = await supabaseClient.from('users').delete().eq('id', userId);
        if (error) throw error;
        users = users.filter(u => u.id !== userId);
        updateStats(); renderRecentUsers(); renderUsers();
        showToast('User deleted successfully!', 'success');
      } catch (error) { console.error('Error deleting user:', error); showToast('Failed to delete user', 'error'); }
    }

    // Business Management
    function viewBusiness(bizId) { showToast('Business details view coming soon', 'success'); }

    async function deleteBusiness(bizId) {
      if (!confirm('Are you sure you want to delete this business?')) return;
      try {
        const { error } = await supabaseClient.from('locations').delete().eq('id', bizId);
        if (error) throw error;
        businesses = businesses.filter(b => b.id !== bizId);
        updateStats(); renderBusinesses();
        showToast('Business deleted successfully!', 'success');
      } catch (error) { console.error('Error deleting business:', error); showToast('Failed to delete business', 'error'); }
    }

    // Export
    function exportReport() {
      const report = {
        generatedAt: new Date().toISOString(),
        stats: { totalUsers: users.length, totalBusinesses: businesses.length, totalReviews: reviews.length },
        users: users, businesses: businesses, reviews: reviews
      };
      const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = `reputehq-report-${Date.now()}.json`; a.click();
      URL.revokeObjectURL(url);
      showToast('Report exported successfully!', 'success');
    }

    // Toast
    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      document.getElementById('toastMessage').textContent = message;
      toast.className = `toast ${type} show`;
      setTimeout(() => toast.classList.remove('show'), 3000);
    }

    // Logout
    function logout() {
      localStorage.removeItem('reputehq_admin');
      window.location.href = 'admin-login.html';
    }

    // Mobile Menu
    function toggleMobileMenu() {
      document.querySelector('.sidebar').classList.toggle('open');
      document.getElementById('mobileOverlay').classList.toggle('active');
    }

    function closeMobileMenu() {
      document.querySelector('.sidebar').classList.remove('open');
      document.getElementById('mobileOverlay').classList.remove('active');
    }
  </script>
</body>
</html>